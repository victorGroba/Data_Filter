{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-cloud-upload"></i>
          Upload de Planilhas Financeiras
        </h5>
      </div>
      <div class="card-body p-4">
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i>
          <strong>Instruções:</strong>
          <ul class="mb-0 mt-2">
            <li>Selecione múltiplos arquivos Excel (.xlsx, .xls) ou CSV</li>
            <li>O sistema buscará automaticamente pela aba "Total Mês"</li>
            <li>Valores e datas serão extraídos automaticamente</li>
            <li>Limite de 50MB por arquivo</li>
          </ul>
        </div>
        
        <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" id="uploadForm">
          <div class="mb-3">
            <label for="files" class="form-label">Selecione as planilhas:</label>
            <input class="form-control" type="file" name="files[]" id="files" 
                   accept=".xlsx,.xls,.xlsm,.csv" multiple required>
            <div class="form-text">Você pode selecionar múltiplos arquivos de uma vez.</div>
          </div>
          
          <div class="d-grid">
            <button class="btn btn-primary btn-lg" type="submit" id="uploadBtn">
              <i class="bi bi-upload"></i>
              Processar Planilhas
            </button>
          </div>
        </form>
        
        <div class="mt-3" id="uploadProgress" style="display: none;">
          <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 100%">
              Processando arquivos...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('uploadForm').addEventListener('submit', function() {
  document.getElementById('uploadBtn').disabled = true;
  document.getElementById('uploadProgress').style.display = 'block';
});

document.getElementById('files').addEventListener('change', function() {
  const files = this.files;
  const fileList = document.createElement('div');
  fileList.className = 'mt-2';
  fileList.innerHTML = '<small class="text-muted">Arquivos selecionados:</small>';
  
  for (let i = 0; i < files.length; i++) {
    const fileItem = document.createElement('div');
    fileItem.className = 'small text-success';
    fileItem.innerHTML = `<i class="bi bi-file-earmark-excel"></i> ${files[i].name}`;
    fileList.appendChild(fileItem);
  }
  
  // Remove lista anterior se existir
  const existing = document.querySelector('.file-list');
  if (existing) existing.remove();
  
  fileList.className += ' file-list';
  this.parentNode.appendChild(fileList);
});
</script>
{% endblock %}